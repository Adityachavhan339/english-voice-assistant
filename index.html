<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>English Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body style="text-align:center; margin-top:50px; font-family:sans-serif;">

  <h2>Tap & Speak ğŸ¤</h2>

  <button onclick="start()" style="font-size:24px;padding:10px 20px;">
    ğŸ™ï¸ Speak
  </button>

  <p id="text" style="margin-top:20px;font-size:18px;"></p>

  <script>
    let recognition;

    function start() {
      const SpeechRecognition =
        window.SpeechRecognition || window.webkitSpeechRecognition;

      if (!SpeechRecognition) {
        alert("Speech recognition not supported on this browser");
        return;
      }

      recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.start();

      recognition.onresult = function (e) {
        const text = e.results[0][0].transcript;
        document.getElementById("text").innerText = text;

        fetch("/api/reply", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        })
        .then(r => r.json())
        .then(d => {
          if (d.reply) {
            speak(d.reply);
          } else {
            speak("I did not get a reply.");
          }
        })
        .catch(() => {
          speak("The AI is not responding right now.");
        });
      };

      recognition.onerror = function (e) {
        alert("Mic error: " + e.error);
      };
    }

    function speak(text) {
      const u = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(u);
    }
  </script>

</body>
</html>
